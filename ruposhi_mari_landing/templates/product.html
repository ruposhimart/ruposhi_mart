{% extends "base.html" %}
{% block content %}

<!-- ЁЯФе ViewContent Event -->
<script>
fbq('track', 'ViewContent', {
    content_name: '{{ product.name }}',
    value: {{ product.price }},
    currency: 'BDT'
});
</script>

<section class="product-details-section">
  <div class="container product-page-wrapper">

    <!-- MAIN IMAGE -->
     <h2 class="product-title">{{ product.name }}</h2>
     <img id="main-img"
         src="{{ url_for('static', filename='images/' + product.image) }}"
         class="product-main-img big-hero-img">

    <!-- OFFER STRIP -->
    <div class="offer-strip-wrapper">
      <div class="regular-price-text">
        ржирж┐ржпрж╝ржорж┐ржд ржорзВрж▓рзНржп:
        <span class="strike-text">рз│ {{ product.old_price }}</span>
      </div>
      <div class="offer-strip">
        ЁЯТе ржЕржлрж╛рж░ ржорзВрж▓рзНржп рж╢рзБрж░рзБ ржорж╛рждрзНрж░ <strong>рз│ {{ product.price }}</strong>
      </div>

      <!-- Scroll to form -->
      <div class="scroll-order-btn" onclick="document.getElementById('order-box').scrollIntoView({behavior:'smooth'})">
        тмЗя╕П ржЕрж░рзНржбрж╛рж░ ржХрж░рзБржи
      </div>
    </div>

    <!-- SHORT DETAILS -->
    <div class="section-box blue-box">
      <h3 class="section-heading orange">рж╕ржВржХрзНрж╖рж┐ржкрзНржд ржмрж┐ржмрж░ржг</h3>
      <p><strong>{{ product.name }}</strong></p>
      <ul class="highlight-list">
        {% for d in product.details %}
        <li>{{ d }}</li>
        {% endfor %}
      </ul>
    </div>

    <!-- HOW TO USE -->
    <div class="section-box yellow-box">
      <h3 class="section-heading orange">ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржирж┐ржпрж╝ржо</h3>
      <ul class="highlight-list">
        {% for h in product.how_to_use %}
        <li>{{ h }}</li>
        {% endfor %}
      </ul>
    </div>

    <!-- COD NOTE -->
    <div class="cod-strip">
      ЁЯЪЪ ржкрзНрж░рзЛржбрж╛ржХрзНржЯ рж╣рж╛рждрзЗ ржкрж╛ржУржпрж╝рж╛рж░ ржкрж░ ржЯрж╛ржХрж╛ ржжрж┐ржи тАУ рззрзжрзж% ржХрзНржпрж╛рж╢ ржЕржи ржбрзЗрж▓рж┐ржнрж╛рж░рж┐ред
    </div>

    <!-- FAQ + ORDER -->
    <div class="faq-and-order-wrapper">

      <!-- FAQ BOX -->
      <div class="section-box faq-box">
  <h3 class="section-heading green">FAQ</h3>

  {% for item in product.faq %}
    <p>тЭУ {{ item.q }}<br>тЬФ {{ item.a }}</p>
  {% endfor %}
</div>

      <!-- ORDER FORM -->
      <div class="section-box order-box" id="order-box">
        <h3 class="section-heading green">ржЕрж░рзНржбрж╛рж░ ржХрж░рзБржи</h3>

        {% if success %}
        <div class="success-message">
          ЁЯОЙ ржЖржкржирж╛рж░ ржЕрж░рзНржбрж╛рж░ рж╕ржлрж▓ржнрж╛ржмрзЗ рж╕ржорзНржкржирзНржи рж╣ржпрж╝рзЗржЫрзЗ! ржЦрзБржм рж╢рзАржШрзНрж░ржЗ ржХржиржлрж╛рж░рзНржо ржХрж▓ ржХрж░рж╛ рж╣ржмрзЗред
        </div>

        <!-- ЁЯФе Lead Event -->
        <script>
        fbq('track', 'Lead', {
            content_name: '{{ product.name }}',
            value: {{ product.price }},
            currency: 'BDT'
        });
        </script>
        {% endif %}

        <form method="POST" class="order-form" id="order-form">
          <input type="text" name="name" placeholder="ржЖржкржирж╛рж░ ржирж╛ржо" required>
          
          <input type="tel" name="phone" placeholder="ржорзЛржмрж╛ржЗрж▓ ржиржорзНржмрж░" required
                 pattern="[0-9]{11}" maxlength="11"
                 title="ржорзЛржмрж╛ржЗрж▓ ржиржорзНржмрж░ ржЕржмрж╢рзНржпржЗ рззрзз ржбрж┐ржЬрж┐ржЯ рж╣рждрзЗ рж╣ржмрзЗ (01XXXXXXXXX)">

          <textarea name="address" placeholder="ржкрзВрж░рзНржг ржарж┐ржХрж╛ржирж╛ рж▓рж┐ржЦрзБржи (ржЬрзЗрж▓рж╛, ржерж╛ржирж╛, ржПрж▓рж╛ржХрж╛)" required></textarea>

          <label>ржкрж░рж┐ржорж╛ржг (ржЕржлрж╛рж░ ржорзВрж▓рзНржпрзЗ):</label>
          <div class="qty-box">
  {% for q, p in product.offers.items() %}
  <div class="qty-option" data-value="{{ q }}">
      {{ q }} ржкрж┐рж╕ - рз│ {{ p }}
  </div>
  {% endfor %}
</div>

<input type="hidden" name="quantity" id="quantityInput" required>

          <div class="note-box delivery-note">
            ржврж╛ржХрж╛рж░ ржнрж┐рждрж░рзЗ ржбрзЗрж▓рж┐ржнрж╛рж░рж┐ ржЪрж╛рж░рзНржЬ рзмрзж ржЯрж╛ржХрж╛ ржПржмржВ ржврж╛ржХрж╛рж░ ржмрж╛ржЗрж░рзЗ ржбрзЗрж▓рж┐ржнрж╛рж░рж┐ ржЪрж╛рж░рзНржЬ рззрзирзж ржЯрж╛ржХрж╛ред
          </div>

          <div class="note-box cod-note">
            ЁЯТ│ ржкрзНрж░рзЛржбрж╛ржХрзНржЯ рж╣рж╛рждрзЗ ржкрзЗржпрж╝рзЗ ржжрж╛ржо ржкрзНрж░ржжрж╛ржи ржХрж░рзБржи (рж╕ржорзНржкрзВрж░рзНржг ржХрзНржпрж╛рж╢ ржЕржи ржбрзЗрж▓рж┐ржнрж╛рж░рж┐)
          </div>

          <button type="submit" class="btn-primary full-width big-order-btn">
            ржЕрж░рзНржбрж╛рж░ ржХржиржлрж╛рж░рзНржо ржХрж░рзБржи
          </button>
        </form>
      </div>

    </div>
  </div>
</section>

<script>
// Smooth Scroll (Backup)
document.querySelector('.scroll-order-btn')?.addEventListener('click', function() {
  document.getElementById('order-box').scrollIntoView({ behavior: 'smooth' });
});

// тЪб Auto Convert Bangla Digits тЖТ English Digits
function convertBanglaToEnglishNumber(input) {
  const banglaDigits = { 'рзж':'0','рзз':'1','рзи':'2','рзй':'3','рзк':'4','рзл':'5','рзм':'6','рзн':'7','рзо':'8','рзп':'9' };
  return input.replace(/[рзж-рзп]/g, d => banglaDigits[d] || d);
}

document.querySelector("input[name='phone']").addEventListener("input", function() {
  this.value = convertBanglaToEnglishNumber(this.value);
});
// Quantity Select Tabs
document.querySelectorAll('.qty-option').forEach(opt => {
    opt.addEventListener('click', function () {

        document.querySelectorAll('.qty-option')
                .forEach(o => o.classList.remove('active'));

        this.classList.add('active');

        document.getElementById('quantityInput').value = this.dataset.value;
    });
});

</script>

{% endblock %}
